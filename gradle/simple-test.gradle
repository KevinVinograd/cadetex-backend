// Plugin simple para tests con Docker
import org.gradle.api.tasks.testing.Test

// Task para verificar Docker
task checkDocker {
    doLast {
        try {
            exec {
                commandLine 'docker', 'version'
            }
            println "‚úÖ Docker CLI disponible"
        } catch (Exception e) {
            println "‚ö†Ô∏è  No se pudo ejecutar 'docker version' (CLI no disponible o permisos)."
            println "    Continuando de todas formas: Testcontainers usar√° el socket si est√° accesible."
        }
    }
}

// Configurar tests
test {
    dependsOn checkDocker
    
    // Configurar JVM para tests
    jvmArgs '-Xmx1g'
    
    // Configurar salida de tests
    testLogging {
        events "passed", "skipped", "failed"
        exceptionFormat "full"
        showStandardStreams = true
    }
    
    // Ejecutar tests en paralelo
    maxParallelForks = 2
    
    // Configurar timeouts
    timeout = Duration.ofMinutes(5)

    // Usar JUnit Platform (Jupiter)
    useJUnitPlatform()
}

// Task para ejecutar tests con reporte
task testWithReport {
    dependsOn test
    doLast {
        println "üìä Reporte de tests disponible en: build/reports/tests/test/index.html"
    }
}



